<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Drive — Premium Explorer</title>
    <meta name="description" content="Stream Drive - Premium Explorer for Movies and TV Series">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2210%22 y=%2220%22 width=%2280%22 height=%2260%22 rx=%2210%22 fill=%22%234285F4%22/><path d=%22M40 35 L70 50 L40 65 Z%22 fill=%22white%22/></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #050505;
            --surface: #111111;
            --accent: #4285F4; 
            --text: #ffffff;
            --text-dim: #94a3b8;
            --folder-gold: #ffb400;
            --file-red: #ff4b4b;
            --border: rgba(255, 255, 255, 0.08);
            --glow: rgba(66, 133, 244, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }

        header {
            background: rgba(17, 17, 17, 0.9);
            backdrop-filter: blur(12px);
            padding: 12px 4%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 1000;
            gap: 15px;
        }
        .header-left { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
        
        .home-btn { 
            color: white; background: var(--accent); 
            width: 40px; height: 40px; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            text-decoration: none; box-shadow: 0 4px 15px var(--glow); transition: 0.3s;
        }
        .home-btn:hover { transform: scale(1.05); }

        .search-container { flex-grow: 1; max-width: 450px; position: relative; }
        .search-container input {
            width: 100%; background: rgba(255,255,255,0.03);
            border: 1px solid var(--border); padding: 10px 15px 10px 40px;
            border-radius: 30px; color: white; transition: 0.3s;
        }
        .search-container input:focus { border-color: var(--accent); }
        .search-container i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-dim); }

        /* Fake Video Player Wrapper */
        .video-stage {
            width: 100%;
            background: #000;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .fake-player {
            width: 100%;
            max-width: 1200px;
            aspect-ratio: 16/9;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            cursor: pointer;
        }

        .fake-player::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 100%);
            transition: 0.3s;
        }

        .play-trigger {
            position: relative;
            z-index: 2;
            width: 80px;
            height: 80px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2rem;
            box-shadow: 0 0 30px var(--glow);
            transition: 0.3s;
        }

        /* Loading Spinner Animation */
        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .fake-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            z-index: 3;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .progress-bar-fake {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255,255,255,0.2);
        }
        .progress-fill-fake {
            width: 0%;
            height: 100%;
            background: var(--accent);
            transition: width 1s linear;
        }

        .content-header { padding: 30px 20px 10px; text-align: center; max-width: 1200px; margin: 0 auto; }
        #headTitle { font-size: 2rem; font-weight: 800; color: var(--accent); display: block; margin-bottom: 10px; }

        .toolbar { 
            max-width: 1200px; margin: 10px auto 30px; padding: 0 20px;
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;
            position: relative;
        }
        .btn-action {
            background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid var(--border);
            padding: 12px 20px; border-radius: 12px; font-weight: 700; font-size: 0.8rem;
            cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.3s;
        }
        .btn-action:hover { background: rgba(255, 255, 255, 0.1); }
        
        .selection-container { max-width: 800px; margin: 0 auto; padding: 0 20px; }
        .label-text { font-size: 0.7rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px; display: block; }
        .select-box {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 16px; padding: 18px 22px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; margin-bottom: 20px;
        }

        .dropdown-content {
            background: #141414; border: 1px solid var(--border); border-radius: 16px;
            margin-top: -15px; margin-bottom: 20px; display: none; max-height: 250px; overflow-y: auto;
        }
        .dropdown-item { padding: 15px 20px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .dropdown-item:hover { background: var(--accent); }

        /* Recommendations Section */
        .rec-section { max-width: 1200px; margin: 50px auto; padding: 0 20px; }
        .rec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .rec-card {
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: 0.3s;
            text-decoration: none;
            color: white;
        }
        .rec-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .rec-img { width: 100%; aspect-ratio: 2/3; background-size: cover; background-position: center; }
        .rec-info { padding: 10px; font-size: 0.8rem; font-weight: 600; text-align: center; }

        @media (max-width: 600px) {
            .header-left span { display: none; }
            #headTitle { font-size: 1.5rem; }
            .play-trigger { width: 60px; height: 60px; font-size: 1.5rem; }
            .rec-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
        }

        footer { text-align: center; padding: 40px; border-top: 1px solid var(--border); margin-top: 50px; opacity: 0.5; font-size: 0.75rem; }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <a href="/" class="home-btn"><i class="fas fa-home"></i></a>
        <span style="font-weight: 800; font-size: 0.9rem; color: var(--accent);">STREAM DRIVE</span>
    </div>

    <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search Movies or Series..." onkeyup="if(event.key === 'Enter') window.location.href='/?search='+this.value">
    </div>

    <a href="#" class="btn-action" style="background: var(--surface); border-radius: 25px; font-size: 0.7rem; font-weight: 800; text-decoration: none;">
        <i class="fas fa-info-circle"></i> <span>INFO</span>
    </a>
</header>

<section class="video-stage">
    <div class="fake-player" id="backdropContainer" onclick="togglePlay()">
        <div class="play-trigger" id="playIcon">
            <i class="fas fa-play" id="playSymbol"></i>
        </div>
        <div class="fake-controls">
            <div class="progress-bar-fake">
                <div class="progress-fill-fake" id="fakeProgress"></div>
            </div>
            <i class="fas fa-play" id="smallPlayBtn"></i>
            <i class="fas fa-volume-up"></i>
            <span style="margin-left: auto;" id="timerDisplay">00:00:00 / 00:00:00</span>
            <i class="fas fa-cog"></i>
            <i class="fas fa-expand"></i>
        </div>
    </div>
</section>

<div class="content-header">
    <h1 id="headTitle">LOADING...</h1>
</div>

<div class="toolbar">
    <button class="btn-action" onclick="addToHome()">
        <i class="fas fa-star"></i> <span>SAVE</span>
    </button>
    
    <button class="btn-action" onclick="shareMovie()">
        <i class="fas fa-share-nodes"></i> <span>SHARE</span>
    </button>
</div>

<main class="selection-container">
    <div id="tvControls" style="display:none;">
        <span class="label-text">Select Season</span>
        <div class="select-box" onclick="toggleDrop('seasonDrop')">
            <div style="display:flex; align-items:center; gap:12px; font-weight:700;">
                <i class="fas fa-folder" style="color:var(--folder-gold);"></i> 
                <span id="sLabel">Season 1</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="seasonDrop" class="dropdown-content"></div>

        <span class="label-text">Select Episode</span>
        <div class="select-box" onclick="toggleDrop('epDrop')">
            <div style="display:flex; align-items:center; gap:12px; font-weight:700;">
                <i class="fas fa-play-circle" style="color:var(--file-red);"></i> 
                <span id="eLabel">Episode 1</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="epDrop" class="dropdown-content"></div>
    </div>
</main>

<!-- Recommendations Section -->
<section class="rec-section">
    <h2 class="label-text" style="font-size: 1rem;">Trending Recommendations</h2>
    <div class="rec-grid" id="recGrid">
        <!-- Recommended items will be injected here -->
    </div>
</section>

<footer>
    <p>&copy; 2026 Stream Drive. All Rights Reserved.</p>
</footer>

<script>
    const API_KEY = '22be462e6d3de1dbab03d1ca50847b5a';
    let id, type, sUrl = 1, eUrl = 1;
    let seriesData = null;
    
    // Timer Variables
    let isPlaying = false;
    let currentTime = 0;
    let totalSeconds = 0;
    let timerInterval = null;

    const path = window.location.pathname.split("/").filter(Boolean);
    if (path[0] === "tv") {
        type = "tv";
        id = path[1];
        sUrl = parseInt(path[2]) || 1;
        eUrl = parseInt(path[3]) || 1;
    } else if (path[0] === "movie") {
        type = "movie";
        id = path[1];
    } else {
        const params = new URLSearchParams(window.location.search);
        id = params.get('id');
        type = params.get('type');
        sUrl = parseInt(params.get('s')) || 1;
        eUrl = parseInt(params.get('e')) || 1;
    }

    async function init() {
        if (!id || !type) return;

        try {
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}`);
            const data = await res.json();
            seriesData = data;

            const name = (data.title || data.name);
            document.getElementById('headTitle').innerText = name.toUpperCase();
            document.title = name + " — Stream Drive";

            if (data.backdrop_path) {
                const backdropUrl = `https://image.tmdb.org/t/p/original${data.backdrop_path}`;
                document.getElementById('backdropContainer').style.backgroundImage = `url('${backdropUrl}')`;
            }

            if (type === 'movie') {
                totalSeconds = (data.runtime || 120) * 60;
                updateTimerDisplay();
            } else if (type === 'tv') {
                document.getElementById('tvControls').style.display = 'block';
                renderSeasons();
                loadEpisodes(sUrl, eUrl);
            }

            loadRecommendations();
        } catch (e) {
            console.error("Failed to load TMDB data");
        }
    }

    async function loadRecommendations() {
        const grid = document.getElementById('recGrid');
        try {
            const res = await fetch(`https://api.themoviedb.org/3/trending/tv/week?api_key=${API_KEY}`);
            const data = await res.json();
            
            grid.innerHTML = data.results.slice(0, 12).map(item => `
                <a href="/tv/${item.id}" class="rec-card">
                    <div class="rec-img" style="background-image: url('https://image.tmdb.org/t/p/w500${item.poster_path}')"></div>
                    <div class="rec-info">${item.name || item.title}</div>
                </a>
            `).join('');
        } catch (e) {
            grid.innerHTML = '<p>Unable to load recommendations.</p>';
        }
    }

    function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        return [h, m, s].map(v => v < 10 ? "0" + v : v).join(":");
    }

    function updateTimerDisplay() {
        const display = document.getElementById('timerDisplay');
        display.innerText = `${formatTime(currentTime)} / ${formatTime(totalSeconds)}`;
        
        const progress = document.getElementById('fakeProgress');
        const percent = totalSeconds > 0 ? (currentTime / totalSeconds) * 100 : 0;
        progress.style.width = percent + "%";
    }

    function togglePlay() {
        const playIcon = document.getElementById('playIcon');
        const playSymbol = document.getElementById('playSymbol');
        const smallPlay = document.getElementById('smallPlayBtn');

        if (!isPlaying) {
            // Start Loading Animation
            playSymbol.className = "fas fa-spinner";
            
            setTimeout(() => {
                isPlaying = true;
                playIcon.style.display = 'none';
                smallPlay.className = 'fas fa-pause';
                
                timerInterval = setInterval(() => {
                    if (currentTime < totalSeconds) {
                        currentTime++;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isPlaying = false;
                        playIcon.style.display = 'flex';
                        playSymbol.className = "fas fa-play";
                        smallPlay.className = 'fas fa-play';
                    }
                }, 1000);
            }, 1500); // Fake delay for loading feel
        } else {
            isPlaying = false;
            playIcon.style.display = 'flex';
            playSymbol.className = "fas fa-play";
            smallPlay.className = 'fas fa-play';
            clearInterval(timerInterval);
        }
    }

    function resetTimer() {
        clearInterval(timerInterval);
        isPlaying = false;
        currentTime = 0;
        document.getElementById('playIcon').style.display = 'flex';
        document.getElementById('playSymbol').className = "fas fa-play";
        document.getElementById('smallPlayBtn').className = 'fas fa-play';
        updateTimerDisplay();
    }

    function renderSeasons() {
        const drop = document.getElementById('seasonDrop');
        if (!drop || !seriesData) return;
        drop.innerHTML = '';

        seriesData.seasons.forEach(s => {
            if (s.season_number === 0) return;
            const item = document.createElement('div');
            item.className = 'dropdown-item';
            item.innerText = `Season ${s.season_number}`;
            item.onclick = () => {
                document.getElementById('sLabel').innerText = `Season ${s.season_number}`;
                toggleDrop('seasonDrop');
                loadEpisodes(s.season_number, 1);
            };
            drop.appendChild(item);
        });
        document.getElementById('sLabel').innerText = `Season ${sUrl}`;
    }

    async function loadEpisodes(sNum, eNum = 1) {
        const drop = document.getElementById('epDrop');
        if (!drop) return;
        drop.innerHTML = '';

        try {
            const res = await fetch(`https://api.themoviedb.org/3/tv/${id}/season/${sNum}?api_key=${API_KEY}`);
            const data = await res.json();

            if (data.episodes && data.episodes.length > 0) {
                totalSeconds = (data.episodes[0].runtime || 45) * 60;
                resetTimer();
            }

            data.episodes.forEach(ep => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                item.innerText = `E${ep.episode_number}: ${ep.name}`;
                item.onclick = async () => {
                    document.getElementById('eLabel').innerText = `Episode ${ep.episode_number}`;
                    toggleDrop('epDrop');
                    history.replaceState(null, "", `/tv/${id}/${sNum}/${ep.episode_number}`);
                    
                    const epRes = await fetch(`https://api.themoviedb.org/3/tv/${id}/season/${sNum}/episode/${ep.episode_number}?api_key=${API_KEY}`);
                    const epData = await epRes.json();
                    totalSeconds = (epData.runtime || 45) * 60;
                    resetTimer();
                };
                drop.appendChild(item);
            });

            document.getElementById('eLabel').innerText = `Episode ${eNum}`;
        } catch (e) {
            console.error("Failed to load episodes");
        }
    }

    function toggleDrop(dropId) {
        const el = document.getElementById(dropId);
        const isVisible = el.style.display === 'block';
        document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
        el.style.display = isVisible ? 'none' : 'block';
    }

    function addToHome() { alert("Use browser menu to Bookmark."); }
    function shareMovie() {
        if(navigator.share) {
            navigator.share({ title: document.title, url: window.location.href });
        } else {
            alert("Link copied to clipboard!");
        }
    }

    init();
</script>
</body>
</html>
