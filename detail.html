<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustWatch-TV — Premium Explorer</title>
    <meta name="description" content="JustWatch-TV - Premium Explorer for Movies and TV Series">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2210%22 y=%2220%22 width=%2280%22 height=%2260%22 rx=%2210%22 fill=%22%236d28d9%22/><path d=%22M40 35 L70 50 L40 65 Z%22 fill=%22white%22/></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #0b0114;
            --surface: #1a0b2e;
            --accent: #ef4444; /* JustWatch Red */
            --purple: #7c3aed; /* JustWatch Purple */
            --text: #ffffff;
            --text-dim: #a78bfa;
            --border: rgba(139, 92, 246, 0.2);
            --glow: rgba(239, 68, 68, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; line-height: 1.5; }

        /* Header Style */
        header {
            background: rgba(11, 1, 20, 0.9);
            backdrop-filter: blur(15px);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 1000;
            gap: 10px;
        }
        .header-left { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
        .logo-text { font-weight: 900; font-size: 1.1rem; letter-spacing: -0.5px; background: linear-gradient(to right, #ef4444, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Custom Home Button Style */
        .home-btn { 
            color: white; 
            background: linear-gradient(135deg, var(--purple), #4c1d95); 
            width: 42px; height: 38px; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            text-decoration: none; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
            transition: 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .home-btn i { font-size: 1.2rem; }
        .home-btn:active { transform: scale(0.9); }

        /* Search input mobile optimized */
        .search-container { flex-grow: 1; position: relative; }
        .search-container input {
            width: 100%; background: rgba(255,255,255,0.05);
            border: 1px solid var(--border); padding: 8px 12px 8px 35px;
            border-radius: 20px; color: white; font-size: 0.85rem; transition: 0.3s;
        }
        .search-container i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-dim); font-size: 0.8rem; }

        /* Video Stage */
        .video-stage { width: 100%; background: #000; position: relative; overflow: hidden; }
        .fake-player {
            width: 100%;
            aspect-ratio: 16/9;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-image 0.5s ease;
        }
        .fake-player::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, rgba(11,1,20,0.7) 100%);
        }

        /* Improved Play Trigger Icon */
        .play-trigger {
            position: relative; z-index: 2;
            width: 75px; height: 75px;
            background: rgba(239, 68, 68, 0.9);
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 1.8rem;
            box-shadow: 0 0 30px var(--glow), inset 0 0 15px rgba(0,0,0,0.3);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(5px);
        }
        .play-trigger i { margin-left: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .play-trigger:hover { transform: scale(1.1); background: var(--accent); }

        .fa-spinner { animation: spin 1s linear infinite; margin-left: 0 !important; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Player Controls */
        .fake-controls {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 50px; background: linear-gradient(transparent, rgba(0,0,0,0.9));
            z-index: 3; display: flex; align-items: center; padding: 0 15px;
            gap: 12px; font-size: 0.8rem;
        }
        .progress-bar-fake { position: absolute; top: 0; left: 0; right: 0; height: 3px; background: rgba(255,255,255,0.2); }
        .progress-fill-fake { width: 0%; height: 100%; background: var(--accent); transition: width 1s linear; }

        /* Title & Meta */
        .content-info { padding: 20px 15px; }
        #headTitle { font-size: 1.4rem; font-weight: 800; color: white; margin-bottom: 5px; text-transform: uppercase; }
        
        .toolbar { display: flex; gap: 10px; margin-bottom: 25px; }
        .btn-action {
            flex: 1; background: var(--surface); color: white; border: 1px solid var(--border);
            padding: 10px; border-radius: 12px; font-weight: 700; font-size: 0.75rem;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .btn-action.primary { background: var(--accent); border: none; }

        /* Selection Dropdowns */
        .selection-container { padding: 0 15px; margin-bottom: 40px; }
        .label-text { font-size: 0.7rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1px; }
        .select-box {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 14px; padding: 15px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; margin-bottom: 12px;
        }
        .dropdown-content {
            background: #1f0d36; border: 1px solid var(--border); border-radius: 14px;
            margin-top: -8px; margin-bottom: 12px; display: none; max-height: 250px; overflow-y: auto;
        }
        .dropdown-item { padding: 12px 15px; border-bottom: 1px solid var(--border); font-size: 0.85rem; transition: 0.2s; }
        .dropdown-item:hover { background: var(--purple); color: white; }

        /* Recommendations Horizontal Scroll */
        .rec-section { margin-top: 20px; padding-bottom: 30px; }
        .scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 10px 15px;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
        }
        .scroll-container::-webkit-scrollbar { display: none; }

        .rec-card {
            flex: 0 0 110px;
            scroll-snap-align: start;
            text-decoration: none;
            color: white;
        }
        .rec-img { 
            width: 100%; aspect-ratio: 2/3; border-radius: 10px; 
            background-size: cover; background-position: center;
            border: 1px solid var(--border);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            margin-bottom: 6px;
        }
        .rec-info { font-size: 0.7rem; font-weight: 600; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        footer { text-align: center; padding: 30px; opacity: 0.4; font-size: 0.7rem; border-top: 1px solid var(--border); }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <a href="/" class="home-btn"><i class="fas fa-home"></i></a>
        <span class="logo-text">JUSTWATCH-TV</span>
    </div>

    <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search..." onkeyup="if(event.key === 'Enter') window.location.href='/?search='+this.value">
    </div>
</header>

<section class="video-stage">
    <div class="fake-player" id="backdropContainer" onclick="togglePlay()">
        <div class="play-trigger" id="playIcon">
            <i class="fas fa-play" id="playSymbol"></i>
        </div>
        <div class="fake-controls">
            <div class="progress-bar-fake">
                <div class="progress-fill-fake" id="fakeProgress"></div>
            </div>
            <i class="fas fa-play" id="smallPlayBtn"></i>
            <span id="timerDisplay">00:00:00 / 00:00:00</span>
            <i class="fas fa-expand" style="margin-left: auto;"></i>
        </div>
    </div>
</section>

<div class="content-info">
    <h1 id="headTitle">LOADING...</h1>
    <div class="toolbar">
        <button class="btn-action primary" onclick="togglePlay()">
            <i class="fas fa-play"></i> <span>WATCH NOW</span>
        </button>
        <button class="btn-action" onclick="shareMovie()">
            <i class="fas fa-share-alt"></i> <span>SHARE</span>
        </button>
    </div>
</div>

<main class="selection-container">
    <div id="tvControls" style="display:none;">
        <span class="label-text">Seasons</span>
        <div class="select-box" onclick="toggleDrop('seasonDrop')">
            <div style="display:flex; align-items:center; gap:10px; font-weight:700;">
                <i class="fas fa-folder" style="color:var(--purple);"></i> 
                <span id="sLabel">Season 1</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="seasonDrop" class="dropdown-content"></div>

        <span class="label-text">Episodes</span>
        <div class="select-box" onclick="toggleDrop('epDrop')">
            <div style="display:flex; align-items:center; gap:10px; font-weight:700;">
                <i class="fas fa-play-circle" style="color:var(--accent);"></i> 
                <span id="eLabel">Episode 1</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="epDrop" class="dropdown-content"></div>
    </div>
</main>

<section class="rec-section">
    <h2 class="label-text" style="padding-left: 15px;">Trending Recommendations</h2>
    <div class="scroll-container" id="recGrid">
        <!-- Recommendations -->
    </div>
</section>

<footer>
    <p>&copy; 2026 JUSTWATCH-TV. All Rights Reserved.</p>
</footer>

<script>
    const API_KEY = '22be462e6d3de1dbab03d1ca50847b5a';
    let id, type, currentS = 1, currentE = 1;
    let seriesData = null;
    
    let isPlaying = false;
    let currentTime = 0;
    let totalSeconds = 0;
    let timerInterval = null;

    const path = window.location.pathname.split("/").filter(Boolean);
    if (path[0] === "tv") {
        type = "tv"; id = path[1];
        currentS = parseInt(path[2]) || 1; currentE = parseInt(path[3]) || 1;
    } else if (path[0] === "movie") {
        type = "movie"; id = path[1];
    } else {
        const params = new URLSearchParams(window.location.search);
        id = params.get('id'); type = params.get('type');
        currentS = parseInt(params.get('s')) || 1; currentE = parseInt(params.get('e')) || 1;
    }

    async function init() {
        if (!id || !type) return;
        try {
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}`);
            const data = await res.json();
            seriesData = data;

            document.getElementById('headTitle').innerText = (data.title || data.name).toUpperCase();
            document.title = (data.title || data.name) + " — JustWatch-TV";

            // Set initial backdrop (default for movie/series)
            updateBackdrop(data.backdrop_path);

            if (type === 'movie') {
                totalSeconds = (data.runtime || 115) * 60;
                updateTimerDisplay();
            } else if (type === 'tv') {
                document.getElementById('tvControls').style.display = 'block';
                renderSeasons();
                loadEpisodes(currentS, currentE);
            }
            loadRecommendations();
        } catch (e) { console.error("API Error", e); }
    }

    function updateBackdrop(path) {
        if (!path) return;
        const backdropUrl = `https://image.tmdb.org/t/p/w780${path}`;
        document.getElementById('backdropContainer').style.backgroundImage = `url('${backdropUrl}')`;
    }

    async function loadRecommendations() {
        const grid = document.getElementById('recGrid');
        try {
            const res = await fetch(`https://api.themoviedb.org/3/trending/all/day?api_key=${API_KEY}`);
            const data = await res.json();
            grid.innerHTML = data.results.slice(0, 10).map(item => `
                <a href="/${item.media_type}/${item.id}" class="rec-card">
                    <div class="rec-img" style="background-image: url('https://image.tmdb.org/t/p/w300${item.poster_path}')"></div>
                    <div class="rec-info">${item.name || item.title}</div>
                </a>
            `).join('');
        } catch (e) { grid.innerHTML = ''; }
    }

    function formatTime(sec) {
        const h = Math.floor(sec / 3600);
        const m = Math.floor((sec % 3600) / 60);
        const s = sec % 60;
        return [h, m, s].map(v => v < 10 ? "0" + v : v).join(":");
    }

    function updateTimerDisplay() {
        document.getElementById('timerDisplay').innerText = `${formatTime(currentTime)} / ${formatTime(totalSeconds)}`;
        const percent = totalSeconds > 0 ? (currentTime / totalSeconds) * 100 : 0;
        document.getElementById('fakeProgress').style.width = percent + "%";
    }

    function togglePlay() {
        const playIcon = document.getElementById('playIcon');
        const playSymbol = document.getElementById('playSymbol');
        const smallPlay = document.getElementById('smallPlayBtn');

        if (!isPlaying) {
            playSymbol.className = "fas fa-spinner";
            setTimeout(() => {
                isPlaying = true;
                playIcon.style.opacity = '0';
                playIcon.style.pointerEvents = 'none';
                smallPlay.className = 'fas fa-pause';
                timerInterval = setInterval(() => {
                    if (currentTime < totalSeconds) { currentTime++; updateTimerDisplay(); }
                    else { resetTimer(); }
                }, 1000);
            }, 800);
        } else {
            isPlaying = false;
            playIcon.style.opacity = '1';
            playIcon.style.pointerEvents = 'auto';
            playSymbol.className = "fas fa-play";
            smallPlay.className = 'fas fa-play';
            clearInterval(timerInterval);
        }
    }

    function resetTimer() {
        clearInterval(timerInterval);
        isPlaying = false;
        currentTime = 0;
        document.getElementById('playIcon').style.opacity = '1';
        document.getElementById('playIcon').style.pointerEvents = 'auto';
        document.getElementById('playSymbol').className = "fas fa-play";
        document.getElementById('smallPlayBtn').className = 'fas fa-play';
        updateTimerDisplay();
    }

    function renderSeasons() {
        const drop = document.getElementById('seasonDrop');
        if (!drop || !seriesData) return;
        drop.innerHTML = seriesData.seasons.filter(s => s.season_number > 0).map(s => `
            <div class="dropdown-item" onclick="selectSeason(${s.season_number})">Season ${s.season_number}</div>
        `).join('');
        document.getElementById('sLabel').innerText = `Season ${currentS}`;
    }

    function selectSeason(n) {
        currentS = n;
        document.getElementById('sLabel').innerText = `Season ${n}`;
        toggleDrop('seasonDrop');
        loadEpisodes(n, 1);
    }

    async function loadEpisodes(sNum, eNum = 1) {
        const drop = document.getElementById('epDrop');
        try {
            const res = await fetch(`https://api.themoviedb.org/3/tv/${id}/season/${sNum}?api_key=${API_KEY}`);
            const data = await res.json();
            
            // Set default episode logic
            const targetEp = data.episodes.find(ep => ep.episode_number == eNum) || data.episodes[0];
            totalSeconds = (targetEp.runtime || 45) * 60;
            
            // Auto Update Backdrop for current episode
            updateBackdrop(targetEp.still_path || seriesData.backdrop_path);
            
            resetTimer();

            drop.innerHTML = data.episodes.map(ep => `
                <div class="dropdown-item" onclick="selectEpisode(${sNum}, ${ep.episode_number}, '${ep.still_path}')">E${ep.episode_number}: ${ep.name}</div>
            `).join('');
            document.getElementById('eLabel').innerText = `Episode ${targetEp.episode_number}`;
        } catch (e) { console.error("Ep Error", e); }
    }

    function selectEpisode(s, e, stillPath) {
        currentE = e;
        document.getElementById('eLabel').innerText = `Episode ${e}`;
        toggleDrop('epDrop');
        
        // Reload backdrop based on episode still_path
        if (stillPath && stillPath !== 'null') {
            updateBackdrop(stillPath);
        } else {
            updateBackdrop(seriesData.backdrop_path);
        }

        history.replaceState(null, "", `/tv/${id}/${s}/${e}`);
        resetTimer();
        
        // Auto Play Feel: Start loading icon when episode changed
        const playSymbol = document.getElementById('playSymbol');
        playSymbol.className = "fas fa-spinner";
        setTimeout(() => { playSymbol.className = "fas fa-play"; }, 600);
    }

    function toggleDrop(dropId) {
        const el = document.getElementById(dropId);
        const current = el.style.display;
        document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
        el.style.display = current === 'block' ? 'none' : 'block';
    }

    function shareMovie() {
        if(navigator.share) navigator.share({ title: document.title, url: window.location.href });
        else alert("Link copied!");
    }

    init();
</script>
</body>
</html>
