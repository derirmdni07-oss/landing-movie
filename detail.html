<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustWatch-TV — Premium Explorer</title>
    <meta name="description" content="JustWatch-TV - Premium Explorer for Movies and TV Series">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2210%22 y=%2220%22 width=%2280%22 height=%2260%22 rx=%2210%22 fill=%22%236d28d9%22/><path d=%22M40 35 L70 50 L40 65 Z%22 fill=%22white%22/></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #0b0114;
            --surface: #1a0b2e;
            --accent: #ef4444; /* JustWatch Red */
            --purple: #7c3aed; /* JustWatch Purple */
            --text: #ffffff;
            --text-dim: #a78bfa;
            --border: rgba(139, 92, 246, 0.2);
            --glow: rgba(239, 68, 68, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; line-height: 1.5; }

        /* Header Style */
        header {
            background: rgba(11, 1, 20, 0.95);
            backdrop-filter: blur(15px);
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 1000;
            gap: 15px;
        }
        .header-left { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
        
        /* Premium Logo Typography */
        .logo-container { display: flex; align-items: center; gap: 5px; text-decoration: none; }
        .logo-icon { 
            background: var(--accent); width: 28px; height: 28px; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem;
            box-shadow: 0 0 15px var(--glow);
        }
        .logo-text { 
            font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 1px;
            background: linear-gradient(to bottom, #ffffff, #a78bfa);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-top: 2px;
        }

        .home-btn { 
            color: white; 
            background: rgba(255,255,255,0.05);
            width: 38px; height: 38px; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; 
            text-decoration: none; border: 1px solid var(--border);
            transition: 0.3s;
        }
        .home-btn:hover { background: var(--purple); border-color: transparent; }

        /* Search input */
        .search-container { flex-grow: 1; position: relative; }
        .search-container input {
            width: 100%; background: rgba(255,255,255,0.05);
            border: 1px solid var(--border); padding: 8px 12px 8px 35px;
            border-radius: 10px; color: white; font-size: 0.85rem;
        }
        .search-container i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-dim); font-size: 0.8rem; }

        /* Video Stage */
        .video-stage { width: 100%; background: #000; position: relative; overflow: hidden; }
        .fake-player {
            width: 100%;
            aspect-ratio: 16/9;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-image 0.5s ease;
        }
        .fake-player::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.8));
        }

        /* Register Overlay (CPA Lock) */
        .register-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 10; display: none; flex-direction: column;
            justify-content: center; align-items: center; padding: 20px; text-align: center;
        }
        .reg-box {
            background: var(--surface); border: 1px solid var(--purple);
            padding: 25px; border-radius: 20px; width: 90%; max-width: 350px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .reg-box h3 { font-size: 1.2rem; margin-bottom: 10px; color: white; }
        .reg-box p { font-size: 0.8rem; color: var(--text-dim); margin-bottom: 20px; }
        .btn-reg {
            display: block; width: 100%; background: var(--accent); color: white;
            text-decoration: none; padding: 12px; border-radius: 10px; font-weight: 800;
            font-size: 0.9rem; margin-bottom: 10px;
        }
        .btn-reg:hover { filter: brightness(1.2); }

        /* Play Trigger Icon */
        .play-trigger {
            position: relative; z-index: 2;
            width: 65px; height: 65px;
            background: rgba(239, 68, 68, 0.95);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 1.5rem;
            box-shadow: 0 0 30px var(--glow);
            transition: 0.3s;
        }

        /* Player Controls Complete */
        .fake-controls {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 60px; background: linear-gradient(transparent, rgba(0,0,0,0.95));
            z-index: 3; display: flex; align-items: center; padding: 0 15px;
            gap: 15px; font-size: 0.9rem;
        }
        .progress-bar-fake { position: absolute; top: 0; left: 0; right: 0; height: 4px; background: rgba(255,255,255,0.1); }
        .progress-fill-fake { width: 35%; height: 100%; background: var(--accent); }
        .control-group { display: flex; align-items: center; gap: 15px; }

        /* Title & Meta */
        .content-info { padding: 20px 15px; }
        #headTitle { font-size: 1.3rem; font-weight: 800; color: white; margin-bottom: 5px; }
        
        .toolbar { display: flex; gap: 10px; margin-bottom: 25px; }
        .btn-action {
            flex: 1; background: var(--surface); color: white; border: 1px solid var(--border);
            padding: 10px; border-radius: 10px; font-weight: 700; font-size: 0.7rem;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .btn-action.primary { background: var(--accent); border: none; }

        /* Selection Dropdowns */
        .selection-container { padding: 0 15px; margin-bottom: 30px; }
        .label-text { font-size: 0.65rem; font-weight: 800; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1px; }
        .select-box {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; padding: 12px 15px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; margin-bottom: 10px; font-size: 0.85rem;
        }
        .dropdown-content {
            background: #1f0d36; border: 1px solid var(--border); border-radius: 12px;
            margin-top: -5px; margin-bottom: 10px; display: none; max-height: 200px; overflow-y: auto;
        }
        .dropdown-item { padding: 10px 15px; border-bottom: 1px solid var(--border); font-size: 0.8rem; }

        /* Recommendations Horizontal Scroll - Smaller & Cleaner */
        .rec-section { margin-top: 10px; padding-bottom: 20px; border-top: 1px solid var(--border); padding-top: 20px; }
        .scroll-container {
            display: flex; overflow-x: auto; gap: 10px;
            padding: 5px 15px; scroll-snap-type: x mandatory; scrollbar-width: none;
        }
        .scroll-container::-webkit-scrollbar { display: none; }

        .rec-card { flex: 0 0 90px; text-decoration: none; color: white; }
        .rec-img { 
            width: 100%; aspect-ratio: 2/3; border-radius: 8px; 
            background-size: cover; background-position: center;
            border: 1px solid rgba(255,255,255,0.05); margin-bottom: 5px;
        }
        .rec-info { font-size: 0.6rem; font-weight: 600; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.8; }

        footer { text-align: center; padding: 30px; opacity: 0.3; font-size: 0.65rem; }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <a href="/" class="logo-container">
            <div class="logo-icon"><i class="fas fa-play"></i></div>
            <span class="logo-text">JUSTWATCH</span>
        </a>
    </div>

    <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Cari..." onkeyup="if(event.key === 'Enter') window.location.href='/?search='+this.value">
    </div>

    <a href="/" class="home-btn"><i class="fas fa-home"></i></a>
</header>

<section class="video-stage">
    <div class="fake-player" id="backdropContainer" onclick="showRegister()">
        <div class="play-trigger" id="playIcon">
            <i class="fas fa-play" id="playSymbol"></i>
        </div>
        
        <!-- CPA Register Lock -->
        <div class="register-overlay" id="regOverlay" onclick="event.stopPropagation()">
            <div class="reg-box">
                <i class="fas fa-lock" style="font-size: 2rem; color: var(--accent); margin-bottom: 15px;"></i>
                <h3>KONTEN TERKUNCI</h3>
                <p>Silahkan daftar akun gratis untuk melanjutkan streaming dalam kualitas Ultra HD 4K.</p>
                <a href="https://your-cpa-link.com" class="btn-reg">DAFTAR GRATIS</a>
                <p style="font-size: 0.6rem; margin-bottom: 0;">Tanpa biaya, proses hanya 1 menit.</p>
            </div>
        </div>

        <div class="fake-controls">
            <div class="progress-bar-fake"><div class="progress-fill-fake"></div></div>
            <div class="control-group">
                <i class="fas fa-play"></i>
                <i class="fas fa-step-forward"></i>
                <i class="fas fa-volume-up"></i>
            </div>
            <span id="timerDisplay" style="font-size: 0.7rem;">00:42:15 / 02:15:00</span>
            <div class="control-group" style="margin-left: auto;">
                <i class="fas fa-closed-captioning"></i>
                <i class="fas fa-cog"></i>
                <i class="fas fa-expand"></i>
            </div>
        </div>
    </div>
</section>

<div class="content-info">
    <h1 id="headTitle">MEMUAT...</h1>
    <div class="toolbar">
        <button class="btn-action primary" onclick="showRegister()">
            <i class="fas fa-play"></i> <span>NONTON SEKARANG</span>
        </button>
        <button class="btn-action" onclick="shareMovie()">
            <i class="fas fa-plus"></i> <span>DAFTAR PUTAR</span>
        </button>
        <button class="btn-action" onclick="shareMovie()">
            <i class="fas fa-download"></i> <span>UNDUH</span>
        </button>
    </div>
</div>

<main class="selection-container">
    <div id="tvControls" style="display:none;">
        <span class="label-text">Pilih Musim</span>
        <div class="select-box" onclick="toggleDrop('seasonDrop')">
            <div style="display:flex; align-items:center; gap:10px; font-weight:700;">
                <i class="fas fa-list-ul" style="color:var(--purple);"></i> 
                <span id="sLabel">Season 1</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="seasonDrop" class="dropdown-content"></div>

        <span class="label-text">Pilih Episode</span>
        <div class="select-box" onclick="toggleDrop('epDrop')">
            <div style="display:flex; align-items:center; gap:10px; font-weight:700;">
                <i class="fas fa-play-circle" style="color:var(--accent);"></i> 
                <span id="eLabel">Episode 1</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="epDrop" class="dropdown-content"></div>
    </div>
</main>

<section class="rec-section">
    <h2 class="label-text" style="padding-left: 15px; margin-bottom: 10px;">Trending Hari Ini</h2>
    <div class="scroll-container" id="recGrid">
        <!-- Recommendations -->
    </div>
</section>

<footer>
    <p>&copy; 2026 JUSTWATCH Premium. All Rights Reserved.</p>
</footer>

<script>
    const API_KEY = '22be462e6d3de1dbab03d1ca50847b5a';
    let id, type, currentS = 1, currentE = 1;
    let seriesData = null;

    const path = window.location.pathname.split("/").filter(Boolean);
    if (path[0] === "tv") {
        type = "tv"; id = path[1];
        currentS = parseInt(path[2]) || 1; currentE = parseInt(path[3]) || 1;
    } else if (path[0] === "movie") {
        type = "movie"; id = path[1];
    } else {
        const params = new URLSearchParams(window.location.search);
        id = params.get('id'); type = params.get('type');
        currentS = parseInt(params.get('s')) || 1; currentE = parseInt(params.get('e')) || 1;
    }

    async function init() {
        if (!id || !type) return;
        try {
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&language=id-ID`);
            const data = await res.json();
            seriesData = data;

            document.getElementById('headTitle').innerText = (data.title || data.name).toUpperCase();
            document.title = (data.title || data.name) + " — Nonton di JustWatch";

            updateBackdrop(data.backdrop_path);

            if (type === 'tv') {
                document.getElementById('tvControls').style.display = 'block';
                renderSeasons();
                loadEpisodes(currentS, currentE);
            }
            loadRecommendations();
        } catch (e) { console.error("API Error", e); }
    }

    function updateBackdrop(path) {
        if (!path) return;
        const backdropUrl = `https://image.tmdb.org/t/p/w780${path}`;
        document.getElementById('backdropContainer').style.backgroundImage = `url('${backdropUrl}')`;
    }

    function showRegister() {
        const playSymbol = document.getElementById('playSymbol');
        playSymbol.className = "fas fa-spinner fa-spin";
        
        setTimeout(() => {
            document.getElementById('regOverlay').style.display = 'flex';
            document.getElementById('playIcon').style.display = 'none';
        }, 1200);
    }

    async function loadRecommendations() {
        const grid = document.getElementById('recGrid');
        try {
            const res = await fetch(`https://api.themoviedb.org/3/trending/all/day?api_key=${API_KEY}`);
            const data = await res.json();
            grid.innerHTML = data.results.slice(0, 15).map(item => `
                <a href="/${item.media_type}/${item.id}" class="rec-card">
                    <div class="rec-img" style="background-image: url('https://image.tmdb.org/t/p/w200${item.poster_path}')"></div>
                    <div class="rec-info">${item.name || item.title}</div>
                </a>
            `).join('');
        } catch (e) { grid.innerHTML = ''; }
    }

    function renderSeasons() {
        const drop = document.getElementById('seasonDrop');
        if (!drop || !seriesData) return;
        drop.innerHTML = seriesData.seasons.filter(s => s.season_number > 0).map(s => `
            <div class="dropdown-item" onclick="selectSeason(${s.season_number})">Season ${s.season_number}</div>
        `).join('');
        document.getElementById('sLabel').innerText = `Season ${currentS}`;
    }

    function selectSeason(n) {
        currentS = n;
        document.getElementById('sLabel').innerText = `Season ${n}`;
        toggleDrop('seasonDrop');
        loadEpisodes(n, 1);
    }

    async function loadEpisodes(sNum, eNum = 1) {
        const drop = document.getElementById('epDrop');
        try {
            const res = await fetch(`https://api.themoviedb.org/3/tv/${id}/season/${sNum}?api_key=${API_KEY}`);
            const data = await res.json();
            const targetEp = data.episodes.find(ep => ep.episode_number == eNum) || data.episodes[0];
            
            updateBackdrop(targetEp.still_path || seriesData.backdrop_path);
            
            // Close register if it was open to reset state
            document.getElementById('regOverlay').style.display = 'none';
            document.getElementById('playIcon').style.display = 'flex';
            document.getElementById('playSymbol').className = "fas fa-play";

            drop.innerHTML = data.episodes.map(ep => `
                <div class="dropdown-item" onclick="selectEpisode(${sNum}, ${ep.episode_number}, '${ep.still_path}')">E${ep.episode_number}: ${ep.name}</div>
            `).join('');
            document.getElementById('eLabel').innerText = `Episode ${targetEp.episode_number}`;
        } catch (e) { console.error("Ep Error", e); }
    }

    function selectEpisode(s, e, stillPath) {
        currentE = e;
        document.getElementById('eLabel').innerText = `Episode ${e}`;
        toggleDrop('epDrop');
        
        if (stillPath && stillPath !== 'null') updateBackdrop(stillPath);
        else updateBackdrop(seriesData.backdrop_path);

        history.replaceState(null, "", `/tv/${id}/${s}/${e}`);
        
        // Reset player UI
        document.getElementById('regOverlay').style.display = 'none';
        document.getElementById('playIcon').style.display = 'flex';
        document.getElementById('playSymbol').className = "fas fa-play";
    }

    function toggleDrop(dropId) {
        const el = document.getElementById(dropId);
        const current = el.style.display;
        document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
        el.style.display = current === 'block' ? 'none' : 'block';
    }

    function shareMovie() {
        if(navigator.share) navigator.share({ title: document.title, url: window.location.href });
        else alert("Link disalin!");
    }

    init();
</script>
</body>
</html>
